# pylint: disable=C0301

from application_client.zcash_command_sender import ZcashCommandSender
from application_client.zcash_response_unpacker import unpack_trusted_input_response

TRUSTED_INPUT_RESPONSE_HEX_LEN = 112

def test_trusted_input_transparent_v5_two_inputs(backend):
    TX_BYTES = bytes.fromhex("050000800a27a726b4d0d6c200000000a8841e00021111111111111111111111111111111111111111111111111111111111111111000000006b483045022100e35dd2be5e5aeccce0ff7ff892db278047685bc11d34692fd72a9c1914d05f8e0220426dd0a98b39eb6051df9706e4ff9fba4a8be5cd6ef5c3fdd6f2200c709b2bad01210228d06186c26df6afa96076b0ac64cf0d8caf212937f328a52894183cc36e5dd8ffffffff2222222222222222222222222222222222222222222222222222222222222222010000006b483045022100abb1831a7c59bd893420bfe51df0627f239ac2c1524de86958fe84f122c5344d022046ef451e009e500c12516f082a03ffafd3743f522790b866af88ef202fc83a1d0121037e0c5efb047f692c0c89ea9a817f577dc086303aed2f662df4879c89448287c7ffffffff01a0860100000000001976a914b1630abe4ac3749ca5b0ea4c30a7eae5abab19be88ac000000")

    trusted_input_idx = 0

    client = ZcashCommandSender(backend)

    resp = client.get_trusted_input(TX_BYTES, trusted_input_idx).data
    txid, idx, amount, _, _ = unpack_trusted_input_response(resp)

    assert txid.hex() == "754d1a6d0c8e7bfaff9bb1d2f356db3475e60e27d27376f64ba0f21c23adbd80"
    assert idx == trusted_input_idx
    assert amount == 100_000

def test_trusted_input_transparent_v5_two_outputs(backend):
    TX_BYTES = bytes.fromhex("050000800a27a726b4d0d6c200000000a8841e00011111111111111111111111111111111111111111111111111111111111111111000000006a47304402207822747dfbbb31fda5ec92ec908bed2fd9b347d14c5756cf7f81f6548c0eb9170220576933ee4c037cf2c4116a5e4bd374b3b5b518ace808ce740637e1c460ac7cc10121031b84c5567b126440995d3ed5aaba0565d71e1834604819ff9c17f5e9d5dd078fffffffff0250973100000000001976a914417d4be90d35363267b8f2afafc9531111c41ae488ac50973100000000001976a914417d4be90d35363267b8f2afafc9531111c41ae488ac000000");

    trusted_input_idx = 1

    client = ZcashCommandSender(backend)

    resp = client.get_trusted_input(TX_BYTES, trusted_input_idx).data
    txid, idx, amount, _, _ = unpack_trusted_input_response(resp)

    assert txid.hex() == "f5f79290d3dfe4e768aec837affe8eb9e46fbc82ef9dfdf2c62af1ad0b3878a3"
    assert idx == trusted_input_idx
    assert amount == 3_250_000

def test_trusted_input_sapling_v5_simple(backend):
    TX_BYTES = bytes.fromhex(
        "050000800a27a7265510e7c8" + "00000000" + "94e02c00" + "00" # header + expiry + locktime + input count
        "01" +
        "20d61300000000001976a914040ac822bd91e60f709174ac94bee1fb1aaadf2a88ac" +
        "010200" +
        "b810140000000000ec191fd9bc3a13624b396dcdef5d13559ced5bcc2058b98f55b2250b9b98b658" +
        "2b88b763bbed1f015f89aca3786acd2702a5ec69482404fc90cb4e6f597827a1884a2be02987a69f1461b3d479661407c8f31f5f26140c964c7e28315e429115c534b33f896e0320f630a4c4418b25db0c2ce8412a386f29be29a138d496a260" +
        "bfd33cf9757e6da7374d12598bdfee4a821f915254a1fed7189a0acecf52aa4087d61a8797497ba66dffeec0d3451b01c16b4dcbcc27f6896cdf59f07d4d535fb3b9f3b7a013d2b69aee28b9d4bdee0eaab836b776e6419324d5690dc1050b0b10063bead8c37ea1ebf03e390be41f313d370e70" +
        "ef91cb7052c730740ca3fdb5082ca9316fd7fbe4ce63ad66fc32bdfe7106bb34f6cf09d89739dff6205051189a6d1bd7aa4f7518e2cf1872272f9a90baa053c932622ebd195de4ce00c7c3fdbdde46c11fd616fee703cf770caa03e9f6ffa1f32b77e21fffee6fa03badeb99dadaafdfd20ad05a" +
        "9953f91cfa0923a220f031b58e536e503cc161a046d7eefe1194f7fe3d879417b3ad8ed4e04620ecf771cf503939eb441fd2586d2711a1d1228292e66bc09986d06e332b697153228efa383094ecb27eca5288771f6a721185ec59bfeb7695b66692de9207a638386304b2fef517c1002158b7a340230d79be282d56764e78c7" +
        "7a4c09bb70874e0888a9c4b54df76e92621ec8ce3981e3413e0ce4576caa99a2fbeee2cbaa9d4448fa22c27fa588455bdb6ea9cf2515c8edb475a6da460a5e0072150f5d71568bf875a6cc0be52944aaa360dd425722ef70ff6e785263b45d0ce6053ea2a48360ad66432b84550e1634d6eb40a99e8c44e229d9de18306325d6" +
        "4f1595c928df3bece71461c281ed948fb54ad4c059cd78e0bd50f39a38cbeeb68977582b90ec18cc799ae9c63fbb028d884d4c32067cd6e73809b42b473c1c5031de16e524fe242c2840d8cb2d554544525e4d2e48655ed17c5d8f98a5f0b30d72a4be22fe250ea5d4b28e51421ecfa3d6c146edafdc90c6950f8f86c1c5db73" +
        "b53e8323a1c59347de9f6a420aab8a1ea3245f0eac5c420e8d2333c25846289515ccfe15288670d870c2de8ff6dc737b5bb15b6d8c59366d59a15b3361475f7de91fabf0972e323356ecd6ee3bbe8129eac8c8a55dbd4945ad6c02b774dd986503ea7dbd1ef4d0fe00e88efbf09cc2ce2754963e085076cbda51a43fe04ffbc5" +
        "98c04020e8a852c105a2b82a543e8e1e3b24646e196fbf1d75fe4bd77a82990a4cf54935d02b33b2853504567b9f8b3c2d056c489d991b16543cfbaf6e69a42cc356b799705085b7b58347272a5ff0c454dc5ba733dc6127d573844e4f7461f57de2ec04eb97bd94dc29f9bd700cd4f7e0f0c5144e1e24c83528735e17ce585d" +
        "4ca2ca7318d44f5fe00b069cc27806c557c5dba69f3e8ab910ba3509f25ec05af5a0f0e7e86eaec4ec1264124c02d7c35bb90ef500cc813d1f1f37ead8eba59e3c7c346042e4bf29055a823c820bb47000d8e0aa07707f33f0ba4254538532066f0e59ac60a64547acf69ba15b4cd61bc6b7e7d4fa111fcbe7eed9cd125f5735" +
        "8c74d1a0db663487ea4f88ae079460c09199e93315defab6ace9df089954beb09dde24549b5ec3e6e0c6d95580ea1a25516016f87b52ecb902c9bc87f9386e668867f920a6c0da05ff9da0718fb6dff84d3f381f1c40da6e1bc75b6045a54296b759f99071e145d99b9772616280d04c278bff7c3688070fc7ac4ff6e0bdb329" +
        "4224af07e1efe10cf57f6898a39b63ddd9792c4effd933414a1cbc23b20ccf1f3624a187b4faab8687ad58b18a4dc5753343ddff7477370f8e766d74e7c5db381910c768270cb62096b110dd9268ad97149fc13c5513024dfafb4093fd6d31c942d9bfb0630f98957d9782dac478f39c6d74affcdf031a56e63e090437d1670a" +
        "d50845284903cd9e2f3da8b5d716217e82aa6021acf7e402a5918dd39602710ca57e7862ccbfa5b7ebf4f999c2450108589143fbcd257fade54537bd6b808f0f59a020033cc09166790f7eae8eb2c236bbcfa0515846939b10f8d675a0c39d5dadf8f8df6039d7c56965255de8b22f43bf40749c65ff1c6b9c939d394e165be0" +
        "66bc1edf06b465f42ffaabddc059f238e02879ade2a08041314665b38ab2e13bfc2a1e75cbd359667fd002f83c70aa35685314e8c9a8e00d3e653a9d90ccff47b02cd6621ee5ddd94e3e3a822c52bbbfce64b8a55bfe6d3da9bfb1b1f8948c3a7fdfee92bf369b43bb432954273d98f251d344aa710d812c8b84b8ab4f694080"
    )

    trusted_input_idx = 0

    client = ZcashCommandSender(backend)

    resp = client.get_trusted_input(TX_BYTES, trusted_input_idx).data
    txid, idx, amount, _, _ = unpack_trusted_input_response(resp)

    assert txid.hex() == "e1360c957489515ddfb5c564962e2c8cb2dc3c651c4a219e25e0b5e569f49d33"
    assert idx == trusted_input_idx
    assert amount == 1_300_000

def test_trusted_input_sapling_v5_multi(backend):
    TX_BYTES = bytes.fromhex(
        "050000800a27a7265510e7c8" + "00000000"+ "d87c2d00" + "00" # header + expiry + locktime + input count
        "01" +
        "40951600000000001976a9142767cba450ee8c78f42c151c2b0a89673686fb0988ac" +
        "030200" +
        "60e31600000000003355b4c7f891cc2ff3f6ea75caf6885eba72c75e94fee5a076afe0394ea1966d" +
        "8b8d5de736a24745b0854cbe0e191a5f39bdae2bc9ae3c43be411f2b549d20738f8c66cac5f3470abeac19d39940f7edeed994add401a209a6c816a2bf259de7fbafb44e3ba4b1aa861a188d273d0fef368b9a2ef9f7f7b0d880abec65a72723" +
        "6471cef68f92c7761bd75fdb6c584193760a16dab8cd2f510753c651b7a8e89ca7f67e513641b7ec3dd9a72785719c7c306e703f2589e8562c659d5d34b170839658294c84eb1a2efd77923a790e68b6268948cb603f851afe60d3b96f738224" +
        "eb9a9088dac9a59155320936e61a0143e22822b6afd53c20f029994d0784d747f8374eeda6f60d31ab1a7462c9d3b92578b01a8e79994103026687713680bb972337d979d4318e5bc2f6d7035e7635b4d5526e1b04ba4089cc330c7348732e9d" +
        "55888f46bee4da6970177672bffc486e4543fe5306104029cd26649e1d60581930885b3146de5204a21819f6665c26e449e23cca619fe58097df1bbc8197842f2aba5bef1fd1d65acec1f26eb8e8b7658b87232aaad3eca72ec2f066ac647401614d4844c0892e4cc012f8b0e2983c39672c80ec" +
        "a96342d24ad5ec914387ec50c31d15b64c9a125261dc0e498caebe4187a2c51e70e63c0f4f431f336592b0a17bc64e455fc6ae20147ee34d1d13fd6b11bc52c78def9e7d58ec2967539f8bdf223a56b6fa2c1595f207945e7dda0612b94a5f2dda4d797e000effdb5f2e712c714b290de19da38e" +

        "ee532afd277b2cce50da918b54a8d4dc0746b9ecf756987aa75914cd9ddf00c890fa02afd62d229f3e039fffbb52693df89de9431975551afd5fd5c9b80a76f769357a7a5c271ec15a2a4dd6ce6de3608139d332db94fb4c71ac13c2226cc81d2271598110aabfb28b884cedb27253aa0df15014a3dc3fbfc859b56ae0657dea" +
        "3d4df68cd5ec183422974c4df25290ef7618b9c6b8e97e6dc7017d1d2db464187f7dd4069c27c3b58b2bc60da03eebb015180bf94ee13aaf2c5dee3aae42e6184ede66141eb0cc26fa8f96fb8ea6f825dc582d072a1534364eea3f9df423a55795b3bd5814d48eca709f8b87c1660ade69b2d4a6ff1dbda23da6c8a0d7f892a0" +
        "663f3ccd63d0063ac80a8d2652c4c422c817e39578570e4aee360a2429bc5476bb23896f652283553b315e28c4c5c94195b823c9c7b24becfe21af74295bfe633bd646c743d1b0d5868e3a71b833316bac88f3656dd2ecafb066158a05ab008dbf923e33786be07446b41613253f75f31f1a4b2cb684be69b69ac20046522b60" +
        "d0193490a849c1ae4faf89740b6c331b09eb8f2c27cce750ef507114e6df584fefd7e2d4df1affe7d3480559b5149114803b8d99570833bdaa80845332cf9a7c17d6d86c32f4af265a1c58251b47ba822527cb89ab456112ca484acd3213d895f23214e5e870b0d3d15632a613812fb755adf420eade22f4b852a752f4619e07" +
        "36a5b044ff66bf7b95a26e6f12b85f111ba48a3f2114867049700bab9921df438a261d9e67e850c96b4aab9c273f9f64a00df0266e6de34ff06d542a8d7525345fd88d13bd02c472e97f4ce21eab32112e26c462c4f8856e1e84d126faf81963bd1796dbbed3fb37237143b9b38f3e2b4e398b29c386c1a5e3ece72b3302c042" +
        "9fb583512da35e7d18bb0fe4a8d37c16c41e62c377112f0c05eebd8d2702b29c10c4695ed28dd517d8a9866991d3265e3b77340ff103c468048484e636dc92d1228aa1e99c91030e2a8a7727fff53fc9bb67055f8c3b188bb3d945006d401645cec07c2e646f6ceeb05640e3bc05b83aa7f2f6de1680aec5e72c2d782163fd01" +
        "6f778f154226cf309c90ba2529f4111bfa360eae8d3d75319fc5e69dbfca29700ac39fb1ffc56ae22c2d0e1a9df3b9376c01944728377cec74286ab0b3c94795ed2eb65d117521c9d0928949c0cc4c782059b257bd547756077d76362754206d884a27122f477888cf950981a19673931c633fb1d13e52e104d93002b408979b" +
        "b5f58dc29bc36394ab96874f12d8d4eccb36fd2cb20151604d106af87613e5ca9ecf46825ba88ac548ad0bd68494c912a022a38e6a903fe2db62e4f1f798b343b4b5f2843f0ca683c91b04f421050e6a9479f5280ed98766451873575be596e25d437ab7dbc347cc015da1c88b7336a1d7956e5d4632496143c14eabe023f26f" +
        "10a595cb47f9aac32e7047109c56a8d49c601d79ec4a6776e8f5f6a3021ce86c8e05fe69ca0d99a4d96a6285ac2079a57c9d40b91b09f832bb47cf7f027a8720214b40cff41f6d3671ccfe63b6f312ee6709b3657cdbdfc99bd276033dd22d255971f256750ce2661f93596373a5664f2a4657b50cb544aac8d36bb9d9d17ddb" +
        "ec224bd72791daed879010322da1614878dacca61370576f0d5a12566f23db806c6ee3e71bb929f9d217a26d692cc4f5a18c400d2de6ce7208190d50be41f5478d076ff42bfb0e4e7e8021f1618f8700966e1e73041683980bd46768647d5ca2a3c706cb470f77fcd1547f8d7e25234b77332220d523813900d562f7f5dbcbb4"
    )

    trusted_input_idx = 1

    client = ZcashCommandSender(backend)

    resp = client.get_trusted_input(TX_BYTES, trusted_input_idx).data
    txid, idx, amount, _, _ = unpack_trusted_input_response(resp)

    assert txid.hex() == "35f812ce32a94bbd7679a7f4a71c08b9fb263462352157a5c87fa569ad1d7814"
    assert idx == trusted_input_idx
    assert amount == 0

def test_trusted_input_orchard_v5_simple(backend):
    TX_BYTES = bytes.fromhex(
        "050000800a27a7265510e7c8" + "00000000"+ "6fe32c00" + "00" # header + expiry + locktime + input count
        "01" +
        "488e1000000000001976a914e58749ee655c0e39ae3ce063a33fb9edc86d23dd88ac" +
        "000002" +
        "310746abef4d8a77fdd55fc303a306f3953f794a95bb8f14d9c94b59d63f792ba9856f1ec074084e8a91d7008cbed27a00a4e4a816f66e2772c5e04b3f876c08671af32842982bcc7f344410d8eb50a2b166e7b00f6a4e7ff64cb368d84fa789ff76ee84fae0912e178422fff4dc220610589d344a461acaf9487f231d5091575a7deec69f9cdccec92a537b5c996e60a6c16f85" +
        "e16a84f5840e498b935bce15d2900a592d33446c14e9b9bfd8d05b4e24d0142ad3bec60fed5d37c0d46a2384516ecb02520a8dc06f83f747504078569c55a0290ea78f4a3b765cd00d69a3f60ad695b42d652b285caf3aea639aadb694e24f374ee493445fdb428c95de6016203993655595c7785d3a0c912bfd6af29601429fb773514ed6eb27f376f56384f52c65f9090fa462" +
        "02f1e4c873bc88dd2eb2036ba2bfa9cc7b515d721844ce251df61955f78c4e84bff6fdc62404cfbd3bd360b5020bae564e47594ef6cbb4687065749579ab477623d2752f38f30eda3d2231a513b0238b4f45101b2378b50acf8877b182bce2b994ff166cb95f6d319e2b50a0eb432ef7fc556a0e66752fe8ebb0b4184c38820c" +
        "733fccbeee6e78f3b72f8d61838721f689c4a6a6b1cf8f0fb6bfa1bbdf860ac1631567de443b9cdde8ccdb458b12413f1a1cc90966b40d34249e60eb49d24d9476c89e19721a2d32ce4dbf125a6ffc0a3a9bf3423328ae97e7a2227a08da8e4d1d5031e9d2a6ee04c8d800b1ce42e223d6a16afb88657a46663d7256288e6949" +
        "b751b4df845a9f544a2366e7976f9ff491e4779dc41431393c7ad99747b2470f24302b28df856506a16ec7b88e77e2c37e2a7a7580d0d6122c63e2f34b63de3011526e6ce4b16bfe43eed07a5364f230d0689c7cc97a2945a7a7e8e8535fa147e665e20bce1d8370e96be7629f34aa72d2a9031c90faf92b8383ed3c51065378" +
        "b01e143fa64a2eb8322fcf01207c740437b9a9470a67815e541ee1cc3da71349c9092bc296e2d20da040120345717b18df4bb6559caca87349389d9b5567267c640f8289f6caf7c701dc11d0decd9996c47227cc6418c3b13bedd9f4086c7b874b96f0e15bbd6793ba29bd74a4f969f75697e1a817ddba599b2878885724727a" +
        "7cf17b3c4c577685b1aa7f19ddb6c0596f48447d7aa8253d8faca7bf9bfdb76217500e6a9f1fb794c2c5dba36a4d7efafdbc74d28b7b6f36234312a1e3a99bb412bbe14ebc9e94287994e7846e14ac765809eef7e87289665d0089ed4f3399d547f9156ed34a0598852d52a4daff4096ebd3998e748de36a262e718514577baf" +
        "7ad16d6be978d382ff83fceefd37cc18940c9f9d7f88e1797023fdd4a017721e876088c86121667780e9a32ed92c749bb018e06157b1c7dcd81d7d35de08e3886338b1c6309b15b099c98281ebb79662526753596f9c5784ef6306c04cadf30f3fa650c2ce49bea66bbbe67580585f7e21cc4d04a16b0f2a3729881307020ee3" +
        "5efac01ae6a79a209dfdc911d4119a57ee9184ac38ccba8475d39c40010d2ae5fbb61fa0b0846cdff83afb9f35e63331743fe8b7098da2e58e0ce97593e9cab30bf362537a49ebe30469fc08aad3e75c9ccdd067d73afa042656a1395d15197f98d3ed1034e0552d852202e4eb34b89b801b10d0402a9d698897e6f9d650f685" +
        "064794d16c7f93755da6db19cd37de31a41746bbb43199e832f0e7f5f675470e9df5d3afc38716873cb0ade0c4b0e1b5e6275d3adf97e260b10fb74fc379407ccb329c4e06645d80c4ab188a7d952a3e631dc16f1ec82e2c5cafd39005006737d047c276aa7ef03325d4405c9e2bd86ad616d9d343dc8cf2b4543a437be4de0d" +
        "bd730701f6e2e1feffc2021707919aaced34d5e43c13a5010695cd9d333c19bf9e6f9133be659f9cc8b53fc1a26f2e1a9e4e132dd0e78df56be5d06688f103b232624758df64f86e09d78667e26b4adad05f7d8a539a15e7e19eff71fd29a71c6f58bf920456d8a1348f1225fc1d0b1abbc25bce80a645839d272389faf7a0d4367dcff461a64922b85186de7534bdac9739c57bd8dccd9c0b543a2c1cb1a2ed" +
        "bdbcc7541c03dab9665eda1bc07682ce3dcf4f2293e1bba1aabdbfeb2464739a9027b8a15f11e25d9efd7886e96a214344bbd44c046b223bd1ee5f0b636c5e07544dd47d91d7e218a16ee75597137e5f4d95e868a9a0939cc41f3d36bae7c2e769f5a6c5607b6f314d667d1a7dd951ae5351c98c4595cce67cec410a6609a15472670b6841cc12719e645b97aad11afce304cb7ffe866cd9297717de348d25c6" +
        "03e0c81000000000006cfe8df49885ea5ba8005b075db957a0f11d524a1f226a2da39e912e990ca93e"
    )

    trusted_input_idx = 0

    client = ZcashCommandSender(backend)

    resp = client.get_trusted_input(TX_BYTES, trusted_input_idx).data
    txid, idx, amount, _, _ = unpack_trusted_input_response(resp)

    assert txid.hex() == "4e1a6be05020adef1760a35aec3671402b57a3693d13e7d7dc8b73f6561c9741"
    assert idx == trusted_input_idx
    assert amount == 1085000

def test_trusted_input_mixed_v5(backend):
    TX_BYTES = bytes.fromhex(
        "050000800a27a7265510e7c8" + "00000000"+ "21ae2d00" + "01" # header + expiry + locktime + input count
        "c9cb94ed1369569d7dc1fe4a1d80f54abbcfb892b41ff4be7e50becdd562affd000000006b" +
        "483045022100d017ef3b219a8d6e2bec22868da4cc6c97290e1c12338a7149edcf05ae3b04ad02203e95f4f7b9c4f68d97bd" +
        "54169722d06d62c35fb96b1602113fdf711d3c80dc44012102884a63ffe58171169f945ace55ba8a3f5166d2805b1e1d8f14" +
        "5adba3def6a361ffffffff" +
        "02" +
        "e0fd1c00000000001976a914a96e684ec46cd8a2f98d6ef4b847c0ee88395e9388ac" +
        "204e0000000000001976a914a8ac052222c8cd80c1baf3b5d6a0ae59ea52f63288ac" +
        "010202" +
        "e8df050000000000257f9151f52fc7167ee5a93e8c339034f829664dcd9a4c451d153e56faa02b48" +
        "ba25cc2d6a1f7f250abf87e695c1edd2b91260ff9787d3b883a53dbdc9e9f75422a9fb2dd665513ab336cdd13a36ae53237be8013a1d2b7e60106f6c8274f7d82d41a476b1d2d4fdf0c7fe30bbf6a5b47c1ddce8a6d3be1266e86e93e2c0c79a" +
        "b5687d2fad2118988514944fab938813b36868d734d4dd35a29ccf195ab2ba270c14fbff2808443a1559666f1a032a92c8fdb5b2885caca17d849e29f276fb96bf8a7954656249fd234cb9c989f5767a55f06e279c9cdd2f3dbc0f169b36cdc96f2c576e45f93d936048c9e4818360261e334f17" +
        "1bf376d5ac1a3418e21f84b34bb7f28cc5dc3525dc268dc8c97a28f66c9c4e53114f810e9a277763580df34d1a2ecb8d380b606777ea17daa5259fab40febfb9f6ebbfc053fc016cff3643d467074c6f3f86bc0e2bcbcb7794e9cde981e6f9869c04768339a61693ce487e3d25d94da24e23d03c" +
        "4aabf3e8512464141a4a949dd7369b88f24b0fc77288a3f214ce3fdf4d10778cadc4c829c76c402054a23dadb1af9f769e1fafdb453f288063a79c1c3ce1b376ebedb3b4035c2f05c51584956835d03464d750f4a151979952866103b243c43e43eea3d002b586f95a0b077ffeff8adec5b8663f2f778397e460f034bf4a5fde" +
        "80fdbdfb24c20f2d36080ade25e1b3df86912977e1a7f43308a0334c4b8269ce1a574f60cfcdc8c9ae1dc38f1227752326b317254a886be7856ea8a25ba976c094af3f7613bf6e06f638dff2708f0327a5f18fe834f071b517eacdfb6d4bd9d383a151d4781642c452280904692868117cd021197720b52a47cbb82868fb01e5" +
        "b85211e4e88a4dc4b0d445a0ed67115ab112f22602436c3b6201e46d5782edcf370b0e666b61c41109541082f998268a6cc7b8e251e147990b8ff0d4114e4fc795c619b25f4bc9afb2d03185118226fc412e914c8d6ddb95334559c1f716cae671524125ebf2987afce72d6d79298a0296fca08edf1850b5fe64b4afbe53d1a9" +
        "97d661c06a944ef1e075260cccff79151396c377f1cfeb71d2797cffd79d2f0834dd0122860dda23999b466f4d4f25c9875b915c3317e7f2ee0f07158a72ac2701da7c9303f75d897ce04edfbdab4bd2f389c86ae8be47173f82b2c9db3fa8f2263cdaac3e845776edc1aa7d877b3ca16761e8ca2f54258836c4bac0df7446b0" +
        "5dd91b29259a23b6f8b636241dc322d77449f7aa9e7f8cefa4b67596248d6a0687ffba652114d55e261d5cddc6eee1d1b60898c34209158b9e87e4766f3bd16486145d8b42a919455509846ff1d9a310bc8c7e3f67629de36bb4dafe5c7ac86240a7ef6c93267de9903260cdbc2110311776a0a4bc840ea180f0b8a5c0bc71ea" +
        "01a16bafa44c64832ff6a94b5de4aa706129cfe0d1c8ac537ff3b333e372d402763b77802c3971e2010277146749550ea2445f044d9ed2816f5e4b9cd3fbacd049b729848a3fc7633f57542d37a68c6ad08d3e74278526f409dc308b23da8799fc2d663e0c487180951fef63cfe223ef0fce8502dd5c584417423cc96edbc565" +
        "ebc73fd462220c995f9ffb638327b210a8ad46cae99d32d43b0270b551469dc81b4f2058bb6e4bd3d835f8f0da6814fefde72d45e03d9cf884c98ebecc60a6c3511f4b183dda601cc9a7aa338fd3b8f22c9eee9587c82fa7ab6e32bd2f8bfbb3366297e2592268e2c1bc9b1ca48dedd2102101529dac0ea26bb4a824da53b28f" +
        "dc0bf3cb9ac3803cae0d79c04e505215b79d1e871503974a3d408b463e5a33ed16cbd98f59aa18932586185c18dfac091f1cfc7ce25a8a80d1a6e3bcc668c9ef3b9f45d4d429f839a54379f670d4ea7ae6840bfe321b7e724f1cf107be4437d7c2d29ebaf10372361772295bd235eb00d87552ae64276eefe6dea4b86c98b2eb" +
        "dfde6692acac11b0548ee8f87063e5beac35d9155602f81f88e1fd26a58608edde7a0daa7b226d60ad98adf02a3a09c96f0957380416c40c4b925634b57da12bacadee830ada83afbdf0a0152ec9609f5101c0c98e67243fbc879d0bf4dd61c5cf6dd9cf181a4a23627865fdd0999fcb118700ae615634dd16b48325ba792fa7" +
        "dcbcbeeca88cdec1d4e915f69eabcfcf52704aff88793738b9e4bcfbc276b89caf76ef2081ca73b3a3cf5d08f1956f2e394fda4c927c67b7ee21391de84a5337580e66588ff45a54c551334203609171ce4f057eb5fe05ad8215fef57ce5ea512d5ce9b580b9baf29aa477b2fb39e361ca63d7825ef393894f4b6cc34b9272a1" +
        "22394dcf84e669203d3b4d33ca5d8e82c4574c86ae6c455aabe90adda032db3bc7b2a567941cd8a60209a85886294f43b66ca26aa0d8e209e226e91dba6d9604ca2fad982b9f650f48af22db3c2d7ad68fd0c6b23cc1b44deb38063dba31f42fa5fa8f6e8a10fbb97bf5e124b393b27b448523231d8ef2488adf61c228fdb1b27c7b851c34809286ec0da345fa78cb4e96113005" +
        "a29f1b32e762dc8323b56c278eeb8dbb3edb6b07f8f7dc361e5f273d710cd622f5e7b190551b4448b29e9dd075927e5862d5a84ebf153538237d76865148ad1ddc213fc43e4667135181aad4e8fdb21e9861b71cad5468dd60c26b22e0543921a1f7ce9eb0ac9bd7081523b546f3c0fb16f888dcc98abe253d34823455a94d1f1fb26058915c4eac42c9762b6777e5637a6eda7e" +
        "d3279b606d39322fd8f143a94954b1b321ac7e1e7d3398f6df0381a6059d8d57690b3dff75c9f52a88231ffa1d9a2273370d4f6ca8d1b49bc567f9c78fa0973e8da516a9b05ab955cf224ecf2673c5f7b732df190f22d0cb1a906ec3759b2ccffb22c13c02b50e8262c275fcfce0858884dd9d93fbb4490fbc19a030b51e0bc1" +
        "323b08c9a0baf05594db3a16a06ae089aba095536871793af184730e978f753ed19aed139d68daff1054e3d7fa3718ef3881bf0e518737264f2bd27805fea7b7a1a95ab8a8c23f39d22b250baa06e584d6aed565e46eb8d9f065682b7d8b60f024019cfa537c4155ed3ab3a951b691995434f29b772b371c390b372d0454170c" +
        "59d59a561f2de143c6060cbf203154961e2d5fa39956e67025d10c97eb592493f7603981a0630741000ea8605ef973eaff2c4f52792ffd9545b239e32bf8715292d0b53d792a1bf879baefa67176256e3eddf65a20c39ab6218518f00778f75c120b5002e371355ecf5348d8827456607414e8acb47905e6ad7c0057043779eb" +
        "953f2c1716218cb249dea65d101e64348f49b06fea6e962156efc34070d2d508f01ef72626b2bdc53b6522d1ec771faeba66f15d7f1c05e0867aa90f2eef65944101ffd95d5529a40068bb180a1e1275af591e686edea8f35f5576ac26e494812631b923c1c0f358a54ceb1ff0a59950a863ac3c00de19a4c97396ca11f67ade" +
        "f96f0664d4d9fd10039ed44f3f44d91b64b26d44ff7eb3160c75a2827718c981616029279338de90ce90aab05632f239e1754aa798d5abeb3976fad27df4c82444eb256aa798eb18c13e52f036fdc95fa0e1dd12db50a8e287ce6a40dd9163b4a2bddcca67e1f1c2cc21f32ced1a3bee20602e098d6cd2147ec8319a3d29aa79" +
        "12f16cb6adfef08f2571c5e663a289350f468653386fc6c95cca29a10d70721db2f484d084bebd84612ebbaf49ea0b9495bcd212b2d6011d38bfd21da390359903770eafe6de7d4c636123321dd72cb597753524b41d01899d1fe8d6f93fbb48e24fdacf20ede15ca055a44fad3fb33b85e8b9d45cd25d758d5733ec0250a3d1" +
        "cd9e5beb04537af18b56feb2fdeaaf7238da25e34afa4a7afefa66bef33ff148e902c93d0da098ccf9084c80ea601516e13506d4ef5f47d234907bc8b6cf02bf0cdf101a4240a16111ff6e403232ae77502b0a7b2b1dd4ba42a8e177628a35ec47ef2d0b84017b16e2c70a04a84c8dfa2073d52f7847140809b433e8df37fd7c" +
        "f44fa1960b93b3f4d5ecacf6da56c58bbce3ad9034ea57c96b8855a429e98c172db2ba476ffbcbedbaba51378f797c2223d8521597b16fff1380d0fc33f5276eb2a63e81efc3b86004bb7755bf3df47bd87dc04ecaebd8db90a15f21a743978b4cc080197a5b1b7084b2375a9a64db29471cdea4d37f0deb42b29721e085b958" +
        "fc8641642bc1316ac75720e00ec34b4b115d398c24f748f4d5c03b02b1a99b20522706c9e9e4de774762b88179d208d5155513b19b48990f151fc087d61ae382cd6fbc035cea383b732070c987535e2031f89f5b6f72b270e8f9e38fad6be4e1eefbd57693825e677680a76367a929f7784195164c48df4d1d713f6bd41b3eb4002a4e96299714652835b2fa272b6aec02ac889d4ce6d1137e34017e945da0ab" +
        "ae46f9c17c65e708e9df10bb18f87efdec837e5fff474cb8cc44e9ca1f3187bdb5a0a02b16c059167498c83f80aac81b899c8c4895de412a79567e99375d8902d4ff431e3221ae5cf6f49ff2390b0e134c7361683b8b5fc6ac560a426a7e35a063380a991b927f436d025b14bd97c82b939ee100fca25d496af3867086438ed0f7984b72d8a089d787de41c52e9b2e59786a33b494f1f66c9e179c3e5efb5173" +
        "0360e31600000000000c27ef9af87128c5167c6c74f93c06d85b65248bb9fbfd2aa6d9d72b5add6c10"
    )

    trusted_input_idx = 0

    client = ZcashCommandSender(backend)

    resp = client.get_trusted_input(TX_BYTES, trusted_input_idx).data
    txid, idx, amount, _, _ = unpack_trusted_input_response(resp)

    assert txid.hex() == "cf6f7dba13fc42b798bd325ea16206ecb8d9ff716e2d3ea057e235a71d584e49"
    assert idx == trusted_input_idx
    assert amount == 1900000

def test_trusted_input_transparent_v5_old_1(backend):
    EXPECTED_TRUSTED_INPUT = "a9a27d42321c7ace2884a65a343abb9755f3eba881e53834bdb4a3fed4432a1301000000"

    transport = ZcashCommandSender(backend)

    # with transparent apdus
    sw, _ = transport.exchange_raw("e04200001100000001050000800a27a7265510e7c801")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800025e1360c957489515ddfb5c564962e2c8cb2dc3c651c4a219e25e0b5e569f49d33000000006b")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000324830450221008844cfb8d9983226f74cdd20cb63ee282360374def5de88d093df7f340775d65022072673cea8cd2092484c1")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000321c6e8c35ab765a9501024a96265bdd3b80d0c46f9190012102495e50ff5127b9b74083bad438208c7a39ddd83301cd04e40b")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000bff5556d3351ab300000000")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000102")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800022a0860100000000001976a914a96e684ec46cd8a2f98d6ef4b847c0ee88395e9388ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800022cedb0e00000000001976a9142495eecd3d7ea979d2066da533f45956a3a6b5c888ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800003000000")
    assert sw == 0x9000
    sw, resp = transport.exchange_raw("e042800009000000000400000000")
    assert sw == 0x9000

    resp = resp.hex()
    assert len(resp) == TRUSTED_INPUT_RESPONSE_HEX_LEN
    assert resp[8:8+32*2+8] == EXPECTED_TRUSTED_INPUT

def test_trusted_input_transparent_v5_old_2(backend):
    EXPECTED_TRUSTED_INPUT = "58854aa4e2e3b82aa2040c0bc3a6dc9b8ac6acb5e15bf0cfeacd09e77249c18a00000000"

    transport = ZcashCommandSender(backend)

    sw, _ = transport.exchange_raw("e04200001100000000050000800a27a726b4d0d6c201")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280002598cd6cd9559cd98109ad0622f899bc38805f11648e4f985ebe344b8238f87b13010000006b")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280003248304502210095104ae9d53a95105be4ba5a31caddff2ae83ced24b21ab4aec6d735d568fad102206e054b158047529bb736")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800032c810902ea7fc8d92f3f604c1b2a8bb0b92f0e6c016a8012102010a560c7325827df0212bca20f5cf6556b1345991b6b64b46")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000b9c616e758230a5ffffffff")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000102")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000221595dd04000000001976a914ca3ba17907dde979bf4e88f5c1be0ddf0847b25d88ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800022a245117c140000001976a914c8b56e00740e62449a053c15bdd4809f720b5cb588ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800003000000")
    assert sw == 0x9000

    sw, resp = transport.exchange_raw("e0428000090000000004f9081a00")
    assert sw == 0x9000

    resp = resp.hex()
    assert len(resp) == TRUSTED_INPUT_RESPONSE_HEX_LEN
    assert resp[8:8+32*2+8] == EXPECTED_TRUSTED_INPUT

def test_trusted_input_sapling_v5_single_old(backend):
    # TXID == 339df469e5b5e0259e214a1c653cdcb28c2c2e9664c5b5df5d518974950c36e1
    TXID_LEN = 112
    EXPECTED_TRUSTED_INPUT = "e1360c957489515ddfb5c564962e2c8cb2dc3c651c4a219e25e0b5e569f49d3300000000"

    transport = ZcashCommandSender(backend)

    # with sapling apdus
    sw, _ = transport.exchange_raw("e04200001100000000050000800a27a7265510e7c800")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000101")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280002220d61300000000001976a914040ac822bd91e60f709174ac94bee1fb1aaadf2a88ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800003010200")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800028b810140000000000ec191fd9bc3a13624b396dcdef5d13559ced5bcc2058b98f55b2250b9b98b658")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000602b88b763bbed1f015f89aca3786acd2702a5ec69482404fc90cb4e6f597827a1884a2be02987a69f1461b3d479661407c8f31f5f26140c964c7e28315e429115c534b33f896e0320f630a4c4418b25db0c2ce8412a386f29be29a138d496a260")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800074bfd33cf9757e6da7374d12598bdfee4a821f915254a1fed7189a0acecf52aa4087d61a8797497ba66dffeec0d3451b01c16b4dcbcc27f6896cdf59f07d4d535fb3b9f3b7a013d2b69aee28b9d4bdee0eaab836b776e6419324d5690dc1050b0b10063bead8c37ea1ebf03e390be41f313d370e70")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800074ef91cb7052c730740ca3fdb5082ca9316fd7fbe4ce63ad66fc32bdfe7106bb34f6cf09d89739dff6205051189a6d1bd7aa4f7518e2cf1872272f9a90baa053c932622ebd195de4ce00c7c3fdbdde46c11fd616fee703cf770caa03e9f6ffa1f32b77e21fffee6fa03badeb99dadaafdfd20ad05a")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000809953f91cfa0923a220f031b58e536e503cc161a046d7eefe1194f7fe3d879417b3ad8ed4e04620ecf771cf503939eb441fd2586d2711a1d1228292e66bc09986d06e332b697153228efa383094ecb27eca5288771f6a721185ec59bfeb7695b66692de9207a638386304b2fef517c1002158b7a340230d79be282d56764e78c7")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000807a4c09bb70874e0888a9c4b54df76e92621ec8ce3981e3413e0ce4576caa99a2fbeee2cbaa9d4448fa22c27fa588455bdb6ea9cf2515c8edb475a6da460a5e0072150f5d71568bf875a6cc0be52944aaa360dd425722ef70ff6e785263b45d0ce6053ea2a48360ad66432b84550e1634d6eb40a99e8c44e229d9de18306325d6")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000804f1595c928df3bece71461c281ed948fb54ad4c059cd78e0bd50f39a38cbeeb68977582b90ec18cc799ae9c63fbb028d884d4c32067cd6e73809b42b473c1c5031de16e524fe242c2840d8cb2d554544525e4d2e48655ed17c5d8f98a5f0b30d72a4be22fe250ea5d4b28e51421ecfa3d6c146edafdc90c6950f8f86c1c5db73")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080b53e8323a1c59347de9f6a420aab8a1ea3245f0eac5c420e8d2333c25846289515ccfe15288670d870c2de8ff6dc737b5bb15b6d8c59366d59a15b3361475f7de91fabf0972e323356ecd6ee3bbe8129eac8c8a55dbd4945ad6c02b774dd986503ea7dbd1ef4d0fe00e88efbf09cc2ce2754963e085076cbda51a43fe04ffbc5")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008098c04020e8a852c105a2b82a543e8e1e3b24646e196fbf1d75fe4bd77a82990a4cf54935d02b33b2853504567b9f8b3c2d056c489d991b16543cfbaf6e69a42cc356b799705085b7b58347272a5ff0c454dc5ba733dc6127d573844e4f7461f57de2ec04eb97bd94dc29f9bd700cd4f7e0f0c5144e1e24c83528735e17ce585d")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000804ca2ca7318d44f5fe00b069cc27806c557c5dba69f3e8ab910ba3509f25ec05af5a0f0e7e86eaec4ec1264124c02d7c35bb90ef500cc813d1f1f37ead8eba59e3c7c346042e4bf29055a823c820bb47000d8e0aa07707f33f0ba4254538532066f0e59ac60a64547acf69ba15b4cd61bc6b7e7d4fa111fcbe7eed9cd125f5735")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000808c74d1a0db663487ea4f88ae079460c09199e93315defab6ace9df089954beb09dde24549b5ec3e6e0c6d95580ea1a25516016f87b52ecb902c9bc87f9386e668867f920a6c0da05ff9da0718fb6dff84d3f381f1c40da6e1bc75b6045a54296b759f99071e145d99b9772616280d04c278bff7c3688070fc7ac4ff6e0bdb329")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000804224af07e1efe10cf57f6898a39b63ddd9792c4effd933414a1cbc23b20ccf1f3624a187b4faab8687ad58b18a4dc5753343ddff7477370f8e766d74e7c5db381910c768270cb62096b110dd9268ad97149fc13c5513024dfafb4093fd6d31c942d9bfb0630f98957d9782dac478f39c6d74affcdf031a56e63e090437d1670a")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080d50845284903cd9e2f3da8b5d716217e82aa6021acf7e402a5918dd39602710ca57e7862ccbfa5b7ebf4f999c2450108589143fbcd257fade54537bd6b808f0f59a020033cc09166790f7eae8eb2c236bbcfa0515846939b10f8d675a0c39d5dadf8f8df6039d7c56965255de8b22f43bf40749c65ff1c6b9c939d394e165be0")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008066bc1edf06b465f42ffaabddc059f238e02879ade2a08041314665b38ab2e13bfc2a1e75cbd359667fd002f83c70aa35685314e8c9a8e00d3e653a9d90ccff47b02cd6621ee5ddd94e3e3a822c52bbbfce64b8a55bfe6d3da9bfb1b1f8948c3a7fdfee92bf369b43bb432954273d98f251d344aa710d812c8b84b8ab4f694080")
    assert sw == 0x9000
    sw, sig = transport.exchange_raw("e042800009000000000494e02c00")
    assert sw == 0x9000

    sig = sig.hex()
    assert len(sig) == TXID_LEN
    assert sig[8:8+32*2+8] == EXPECTED_TRUSTED_INPUT


def test_trusted_input_sapling_v5_single_old_2(backend):
    # TXID == ce3068ad41cf91bf2c5fa3a3dd1adb5e362cff92474fa1a9e20a2460d5a15861
    TXID_LEN = 112
    EXPECTED_TRUSTED_INPUT = "6158a1d560240ae2a9a14f4792ff2c365edb1adda3a35f2cbf91cf41ad6830ce00000000"

    transport = ZcashCommandSender(backend)

    # transparent inputs+outputs + sapling outputs
    sw, _ = transport.exchange_raw("e04200001100000000050000800a27a7265510e7c801")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800025c8cac5a1a3131c7842b5aa5fafe964b95514c2787932e0ba33342d783e20f828000000006a")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800032473044022056f4f3646dfedf12f7e54e9b7df23a128816540526b22a9bff458f3d54865cca02200e24886a8e69a3c2cc6d33")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800032d9144b2429c9ed58016c2a001964b59359baa5c793012102884a63ffe58171169f945ace55ba8a3f5166d2805b1e1d8f145a")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000adba3def6a361ffffffff")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000101")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280002228ed0800000000001976a914a8ac052222c8cd80c1baf3b5d6a0ae59ea52f63288ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800003000100")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000840a3eaffffffffff")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280007416ee213af48ecea96d1932854dcfaed9f106b4cba41a3e95a0f57359ffd96271b1de229aecb05b40ef4150c38ff0f1a738191b26055208eb0eaf5d64df9202919a85be6dba4a3437f6e76ae3e1af5e5fd18b9442b0a92deb4bd89a0ff75dfbe5b65b7065a8ce795f182c6c25e8f4e470eb3e6438")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000801ab0eb032c471a9a9437a77c67cee71e663f162cdb4808249e6decc3dafb0a01e52b06bd55dcaca52b016eb5a1f0c6f91ec360c58dcd3e1884fd8150bff182211076ada7a33a564a92dccae5d4de5ce3db724b43c0aa93ee4aa0c0fb62c36691af7c3fa94100770a84380f2ecbc535af9c4e05d3722d24c2eb210c66a8047ece")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080cd6a6456fe52f360f4379e5b0f3cd92839a1f3589802b090cf7435d7a32a9acef85f3e1c6e4b27c540915b562d0eb48d6b6b34bf824c8288d1f873cf705dadf92c2ac67f0803b3df3d8ff2c6d8faae753eb2025a83cad4696d84c1be665642de572f5da0a3dd9c4bd4982d11dc11fe7598f6d6b6ffd9b31db21a586f8aadc10b")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080c5e6d09f547bd7e409d3da080e849b41619bc1dd65582f4344525b95c0949d61b975739bee59aff4316c8da07775ff1765aca91fe3e5885c564c3471c6ab1931c272745ac4a48d1d121419520265d9ed52dec439d12b2c2ecced81a6c690f8cc336898a8edb2a336436d7e187740d328c6b7eba87673192ca5a40bd7289b0158")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008052de64dd8e4d4315ad7ba07e43e574f32467de79710bfeb9e4693c60b980ee98207f457a1be6fdc2a8bbfa90c52f61feaced2d07b01cde652d45161293e922bc34a7a6003197171d72b079b2f01fffb5bf3ca6864696d7cc47d44b374b506bf0e65a8159cfbbd45444574dc40c8cbb4ed39a31f7bcd55aacaa2c551babc84927")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008023d14a3ddd838b1ec22a79bf6b7f238410a19fd0d8a68da0411933000011f942abd24b6787d65f626bc8fb85f3879431606936a1f463b800e9c39c6f59c1b7dce9fda0493866a180e2cb113228bff68adb8f77f4887f1038ce53e6f920c978d9824926dddf4c386b0afc5ec9306b2823b9c33087ed5d10bd817c5e03c82c9cc8")
    assert sw == 0x9000
    sw, sig = transport.exchange_raw("e042800009000000000411a02d00")
    assert sw == 0x9000

    sig = sig.hex()
    assert len(sig) == TXID_LEN
    assert sig[8:8+32*2+8] == EXPECTED_TRUSTED_INPUT

def test_trusted_input_sapling_v5_multi_old(backend):
    # TXID == 14781dad69a57fc8a5572135623426fbb9081ca7f4a77976bd4ba932ce12f835
    TXID_LEN = 112
    EXPECTED_TRUSTED_INPUT = "35f812ce32a94bbd7679a7f4a71c08b9fb263462352157a5c87fa569ad1d781401000000"

    transport = ZcashCommandSender(backend)

    # with sapling apdus
    sw, _ = transport.exchange_raw("e04200001100000001050000800a27a7265510e7c800")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000101")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280002240951600000000001976a9142767cba450ee8c78f42c151c2b0a89673686fb0988ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800003030200")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280002860e31600000000003355b4c7f891cc2ff3f6ea75caf6885eba72c75e94fee5a076afe0394ea1966d")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000608b8d5de736a24745b0854cbe0e191a5f39bdae2bc9ae3c43be411f2b549d20738f8c66cac5f3470abeac19d39940f7edeed994add401a209a6c816a2bf259de7fbafb44e3ba4b1aa861a188d273d0fef368b9a2ef9f7f7b0d880abec65a72723")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000606471cef68f92c7761bd75fdb6c584193760a16dab8cd2f510753c651b7a8e89ca7f67e513641b7ec3dd9a72785719c7c306e703f2589e8562c659d5d34b170839658294c84eb1a2efd77923a790e68b6268948cb603f851afe60d3b96f738224")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800060eb9a9088dac9a59155320936e61a0143e22822b6afd53c20f029994d0784d747f8374eeda6f60d31ab1a7462c9d3b92578b01a8e79994103026687713680bb972337d979d4318e5bc2f6d7035e7635b4d5526e1b04ba4089cc330c7348732e9d")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280007455888f46bee4da6970177672bffc486e4543fe5306104029cd26649e1d60581930885b3146de5204a21819f6665c26e449e23cca619fe58097df1bbc8197842f2aba5bef1fd1d65acec1f26eb8e8b7658b87232aaad3eca72ec2f066ac647401614d4844c0892e4cc012f8b0e2983c39672c80ec")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800074a96342d24ad5ec914387ec50c31d15b64c9a125261dc0e498caebe4187a2c51e70e63c0f4f431f336592b0a17bc64e455fc6ae20147ee34d1d13fd6b11bc52c78def9e7d58ec2967539f8bdf223a56b6fa2c1595f207945e7dda0612b94a5f2dda4d797e000effdb5f2e712c714b290de19da38e")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080ee532afd277b2cce50da918b54a8d4dc0746b9ecf756987aa75914cd9ddf00c890fa02afd62d229f3e039fffbb52693df89de9431975551afd5fd5c9b80a76f769357a7a5c271ec15a2a4dd6ce6de3608139d332db94fb4c71ac13c2226cc81d2271598110aabfb28b884cedb27253aa0df15014a3dc3fbfc859b56ae0657dea")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000803d4df68cd5ec183422974c4df25290ef7618b9c6b8e97e6dc7017d1d2db464187f7dd4069c27c3b58b2bc60da03eebb015180bf94ee13aaf2c5dee3aae42e6184ede66141eb0cc26fa8f96fb8ea6f825dc582d072a1534364eea3f9df423a55795b3bd5814d48eca709f8b87c1660ade69b2d4a6ff1dbda23da6c8a0d7f892a0")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080663f3ccd63d0063ac80a8d2652c4c422c817e39578570e4aee360a2429bc5476bb23896f652283553b315e28c4c5c94195b823c9c7b24becfe21af74295bfe633bd646c743d1b0d5868e3a71b833316bac88f3656dd2ecafb066158a05ab008dbf923e33786be07446b41613253f75f31f1a4b2cb684be69b69ac20046522b60")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080d0193490a849c1ae4faf89740b6c331b09eb8f2c27cce750ef507114e6df584fefd7e2d4df1affe7d3480559b5149114803b8d99570833bdaa80845332cf9a7c17d6d86c32f4af265a1c58251b47ba822527cb89ab456112ca484acd3213d895f23214e5e870b0d3d15632a613812fb755adf420eade22f4b852a752f4619e07")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008036a5b044ff66bf7b95a26e6f12b85f111ba48a3f2114867049700bab9921df438a261d9e67e850c96b4aab9c273f9f64a00df0266e6de34ff06d542a8d7525345fd88d13bd02c472e97f4ce21eab32112e26c462c4f8856e1e84d126faf81963bd1796dbbed3fb37237143b9b38f3e2b4e398b29c386c1a5e3ece72b3302c042")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000809fb583512da35e7d18bb0fe4a8d37c16c41e62c377112f0c05eebd8d2702b29c10c4695ed28dd517d8a9866991d3265e3b77340ff103c468048484e636dc92d1228aa1e99c91030e2a8a7727fff53fc9bb67055f8c3b188bb3d945006d401645cec07c2e646f6ceeb05640e3bc05b83aa7f2f6de1680aec5e72c2d782163fd01")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000806f778f154226cf309c90ba2529f4111bfa360eae8d3d75319fc5e69dbfca29700ac39fb1ffc56ae22c2d0e1a9df3b9376c01944728377cec74286ab0b3c94795ed2eb65d117521c9d0928949c0cc4c782059b257bd547756077d76362754206d884a27122f477888cf950981a19673931c633fb1d13e52e104d93002b408979b")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080b5f58dc29bc36394ab96874f12d8d4eccb36fd2cb20151604d106af87613e5ca9ecf46825ba88ac548ad0bd68494c912a022a38e6a903fe2db62e4f1f798b343b4b5f2843f0ca683c91b04f421050e6a9479f5280ed98766451873575be596e25d437ab7dbc347cc015da1c88b7336a1d7956e5d4632496143c14eabe023f26f")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008010a595cb47f9aac32e7047109c56a8d49c601d79ec4a6776e8f5f6a3021ce86c8e05fe69ca0d99a4d96a6285ac2079a57c9d40b91b09f832bb47cf7f027a8720214b40cff41f6d3671ccfe63b6f312ee6709b3657cdbdfc99bd276033dd22d255971f256750ce2661f93596373a5664f2a4657b50cb544aac8d36bb9d9d17ddb")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080ec224bd72791daed879010322da1614878dacca61370576f0d5a12566f23db806c6ee3e71bb929f9d217a26d692cc4f5a18c400d2de6ce7208190d50be41f5478d076ff42bfb0e4e7e8021f1618f8700966e1e73041683980bd46768647d5ca2a3c706cb470f77fcd1547f8d7e25234b77332220d523813900d562f7f5dbcbb4")
    assert sw == 0x9000
    sw, sig = transport.exchange_raw("e0428000090000000004d87c2d00")
    assert sw == 0x9000


    sig = sig.hex()
    assert len(sig) == TXID_LEN
    assert sig[8:8+32*2+8] == EXPECTED_TRUSTED_INPUT

def test_trusted_input_orchard_v5_old(backend):
    # TXID == 339df469e5b5e0259e214a1c653cdcb28c2c2e9664c5b5df5d518974950c36e1
    TXID_LEN = 112
    EXPECTED_TRUSTED_INPUT = "4e1a6be05020adef1760a35aec3671402b57a3693d13e7d7dc8b73f6561c974100000000"

    transport = ZcashCommandSender(backend)

    # with orchard apdus
    sw, _ = transport.exchange_raw("e04200001100000000050000800a27a7265510e7c800")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000101")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800022488e1000000000001976a914e58749ee655c0e39ae3ce063a33fb9edc86d23dd88ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800003000002")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800094310746abef4d8a77fdd55fc303a306f3953f794a95bb8f14d9c94b59d63f792ba9856f1ec074084e8a91d7008cbed27a00a4e4a816f66e2772c5e04b3f876c08671af32842982bcc7f344410d8eb50a2b166e7b00f6a4e7ff64cb368d84fa789ff76ee84fae0912e178422fff4dc220610589d344a461acaf9487f231d5091575a7deec69f9cdccec92a537b5c996e60a6c16f85")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800094e16a84f5840e498b935bce15d2900a592d33446c14e9b9bfd8d05b4e24d0142ad3bec60fed5d37c0d46a2384516ecb02520a8dc06f83f747504078569c55a0290ea78f4a3b765cd00d69a3f60ad695b42d652b285caf3aea639aadb694e24f374ee493445fdb428c95de6016203993655595c7785d3a0c912bfd6af29601429fb773514ed6eb27f376f56384f52c65f9090fa462")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008002f1e4c873bc88dd2eb2036ba2bfa9cc7b515d721844ce251df61955f78c4e84bff6fdc62404cfbd3bd360b5020bae564e47594ef6cbb4687065749579ab477623d2752f38f30eda3d2231a513b0238b4f45101b2378b50acf8877b182bce2b994ff166cb95f6d319e2b50a0eb432ef7fc556a0e66752fe8ebb0b4184c38820c")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080733fccbeee6e78f3b72f8d61838721f689c4a6a6b1cf8f0fb6bfa1bbdf860ac1631567de443b9cdde8ccdb458b12413f1a1cc90966b40d34249e60eb49d24d9476c89e19721a2d32ce4dbf125a6ffc0a3a9bf3423328ae97e7a2227a08da8e4d1d5031e9d2a6ee04c8d800b1ce42e223d6a16afb88657a46663d7256288e6949")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080b751b4df845a9f544a2366e7976f9ff491e4779dc41431393c7ad99747b2470f24302b28df856506a16ec7b88e77e2c37e2a7a7580d0d6122c63e2f34b63de3011526e6ce4b16bfe43eed07a5364f230d0689c7cc97a2945a7a7e8e8535fa147e665e20bce1d8370e96be7629f34aa72d2a9031c90faf92b8383ed3c51065378")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080b01e143fa64a2eb8322fcf01207c740437b9a9470a67815e541ee1cc3da71349c9092bc296e2d20da040120345717b18df4bb6559caca87349389d9b5567267c640f8289f6caf7c701dc11d0decd9996c47227cc6418c3b13bedd9f4086c7b874b96f0e15bbd6793ba29bd74a4f969f75697e1a817ddba599b2878885724727a")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000807cf17b3c4c577685b1aa7f19ddb6c0596f48447d7aa8253d8faca7bf9bfdb76217500e6a9f1fb794c2c5dba36a4d7efafdbc74d28b7b6f36234312a1e3a99bb412bbe14ebc9e94287994e7846e14ac765809eef7e87289665d0089ed4f3399d547f9156ed34a0598852d52a4daff4096ebd3998e748de36a262e718514577baf")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000807ad16d6be978d382ff83fceefd37cc18940c9f9d7f88e1797023fdd4a017721e876088c86121667780e9a32ed92c749bb018e06157b1c7dcd81d7d35de08e3886338b1c6309b15b099c98281ebb79662526753596f9c5784ef6306c04cadf30f3fa650c2ce49bea66bbbe67580585f7e21cc4d04a16b0f2a3729881307020ee3")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000805efac01ae6a79a209dfdc911d4119a57ee9184ac38ccba8475d39c40010d2ae5fbb61fa0b0846cdff83afb9f35e63331743fe8b7098da2e58e0ce97593e9cab30bf362537a49ebe30469fc08aad3e75c9ccdd067d73afa042656a1395d15197f98d3ed1034e0552d852202e4eb34b89b801b10d0402a9d698897e6f9d650f685")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080064794d16c7f93755da6db19cd37de31a41746bbb43199e832f0e7f5f675470e9df5d3afc38716873cb0ade0c4b0e1b5e6275d3adf97e260b10fb74fc379407ccb329c4e06645d80c4ab188a7d952a3e631dc16f1ec82e2c5cafd39005006737d047c276aa7ef03325d4405c9e2bd86ad616d9d343dc8cf2b4543a437be4de0d")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000a0bd730701f6e2e1feffc2021707919aaced34d5e43c13a5010695cd9d333c19bf9e6f9133be659f9cc8b53fc1a26f2e1a9e4e132dd0e78df56be5d06688f103b232624758df64f86e09d78667e26b4adad05f7d8a539a15e7e19eff71fd29a71c6f58bf920456d8a1348f1225fc1d0b1abbc25bce80a645839d272389faf7a0d4367dcff461a64922b85186de7534bdac9739c57bd8dccd9c0b543a2c1cb1a2ed")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000a0bdbcc7541c03dab9665eda1bc07682ce3dcf4f2293e1bba1aabdbfeb2464739a9027b8a15f11e25d9efd7886e96a214344bbd44c046b223bd1ee5f0b636c5e07544dd47d91d7e218a16ee75597137e5f4d95e868a9a0939cc41f3d36bae7c2e769f5a6c5607b6f314d667d1a7dd951ae5351c98c4595cce67cec410a6609a15472670b6841cc12719e645b97aad11afce304cb7ffe866cd9297717de348d25c6")
    assert sw == 0x9000
    sw, sig = transport.exchange_raw("e04280002903e0c81000000000006cfe8df49885ea5ba8005b075db957a0f11d524a1f226a2da39e912e990ca93e")
    assert sw == 0x9000
    sw, sig = transport.exchange_raw("e04280000900000000046fe32c00")
    assert sw == 0x9000

    sig = sig.hex()
    assert len(sig) == TXID_LEN
    assert sig[8:8+32*2+8] == EXPECTED_TRUSTED_INPUT

def test_trusted_input_mixed_v5_old(backend): #inputs from transparent+sapling+orchard
    # TXID == 494e581da735e257a03e2d6e71ffd9b8ec0662a15e32bd98b742fc13ba7d6fcf
    TXID_LEN = 112
    EXPECTED_TRUSTED_INPUT = "cf6f7dba13fc42b798bd325ea16206ecb8d9ff716e2d3ea057e235a71d584e4900000000"

    transport = ZcashCommandSender(backend)

    sw, _ = transport.exchange_raw("e04200001100000000050000800a27a7265510e7c801")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800025c9cb94ed1369569d7dc1fe4a1d80f54abbcfb892b41ff4be7e50becdd562affd000000006b")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800032483045022100d017ef3b219a8d6e2bec22868da4cc6c97290e1c12338a7149edcf05ae3b04ad02203e95f4f7b9c4f68d97bd")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280003254169722d06d62c35fb96b1602113fdf711d3c80dc44012102884a63ffe58171169f945ace55ba8a3f5166d2805b1e1d8f14")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000b5adba3def6a361ffffffff")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280000102")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800022e0fd1c00000000001976a914a96e684ec46cd8a2f98d6ef4b847c0ee88395e9388ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800022204e0000000000001976a914a8ac052222c8cd80c1baf3b5d6a0ae59ea52f63288ac")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800003010202")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800028e8df050000000000257f9151f52fc7167ee5a93e8c339034f829664dcd9a4c451d153e56faa02b48")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800060ba25cc2d6a1f7f250abf87e695c1edd2b91260ff9787d3b883a53dbdc9e9f75422a9fb2dd665513ab336cdd13a36ae53237be8013a1d2b7e60106f6c8274f7d82d41a476b1d2d4fdf0c7fe30bbf6a5b47c1ddce8a6d3be1266e86e93e2c0c79a")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800074b5687d2fad2118988514944fab938813b36868d734d4dd35a29ccf195ab2ba270c14fbff2808443a1559666f1a032a92c8fdb5b2885caca17d849e29f276fb96bf8a7954656249fd234cb9c989f5767a55f06e279c9cdd2f3dbc0f169b36cdc96f2c576e45f93d936048c9e4818360261e334f17")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000741bf376d5ac1a3418e21f84b34bb7f28cc5dc3525dc268dc8c97a28f66c9c4e53114f810e9a277763580df34d1a2ecb8d380b606777ea17daa5259fab40febfb9f6ebbfc053fc016cff3643d467074c6f3f86bc0e2bcbcb7794e9cde981e6f9869c04768339a61693ce487e3d25d94da24e23d03c")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000804aabf3e8512464141a4a949dd7369b88f24b0fc77288a3f214ce3fdf4d10778cadc4c829c76c402054a23dadb1af9f769e1fafdb453f288063a79c1c3ce1b376ebedb3b4035c2f05c51584956835d03464d750f4a151979952866103b243c43e43eea3d002b586f95a0b077ffeff8adec5b8663f2f778397e460f034bf4a5fde")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008080fdbdfb24c20f2d36080ade25e1b3df86912977e1a7f43308a0334c4b8269ce1a574f60cfcdc8c9ae1dc38f1227752326b317254a886be7856ea8a25ba976c094af3f7613bf6e06f638dff2708f0327a5f18fe834f071b517eacdfb6d4bd9d383a151d4781642c452280904692868117cd021197720b52a47cbb82868fb01e5")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080b85211e4e88a4dc4b0d445a0ed67115ab112f22602436c3b6201e46d5782edcf370b0e666b61c41109541082f998268a6cc7b8e251e147990b8ff0d4114e4fc795c619b25f4bc9afb2d03185118226fc412e914c8d6ddb95334559c1f716cae671524125ebf2987afce72d6d79298a0296fca08edf1850b5fe64b4afbe53d1a9")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008097d661c06a944ef1e075260cccff79151396c377f1cfeb71d2797cffd79d2f0834dd0122860dda23999b466f4d4f25c9875b915c3317e7f2ee0f07158a72ac2701da7c9303f75d897ce04edfbdab4bd2f389c86ae8be47173f82b2c9db3fa8f2263cdaac3e845776edc1aa7d877b3ca16761e8ca2f54258836c4bac0df7446b0")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000805dd91b29259a23b6f8b636241dc322d77449f7aa9e7f8cefa4b67596248d6a0687ffba652114d55e261d5cddc6eee1d1b60898c34209158b9e87e4766f3bd16486145d8b42a919455509846ff1d9a310bc8c7e3f67629de36bb4dafe5c7ac86240a7ef6c93267de9903260cdbc2110311776a0a4bc840ea180f0b8a5c0bc71ea")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008001a16bafa44c64832ff6a94b5de4aa706129cfe0d1c8ac537ff3b333e372d402763b77802c3971e2010277146749550ea2445f044d9ed2816f5e4b9cd3fbacd049b729848a3fc7633f57542d37a68c6ad08d3e74278526f409dc308b23da8799fc2d663e0c487180951fef63cfe223ef0fce8502dd5c584417423cc96edbc565")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080ebc73fd462220c995f9ffb638327b210a8ad46cae99d32d43b0270b551469dc81b4f2058bb6e4bd3d835f8f0da6814fefde72d45e03d9cf884c98ebecc60a6c3511f4b183dda601cc9a7aa338fd3b8f22c9eee9587c82fa7ab6e32bd2f8bfbb3366297e2592268e2c1bc9b1ca48dedd2102101529dac0ea26bb4a824da53b28f")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080dc0bf3cb9ac3803cae0d79c04e505215b79d1e871503974a3d408b463e5a33ed16cbd98f59aa18932586185c18dfac091f1cfc7ce25a8a80d1a6e3bcc668c9ef3b9f45d4d429f839a54379f670d4ea7ae6840bfe321b7e724f1cf107be4437d7c2d29ebaf10372361772295bd235eb00d87552ae64276eefe6dea4b86c98b2eb")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080dfde6692acac11b0548ee8f87063e5beac35d9155602f81f88e1fd26a58608edde7a0daa7b226d60ad98adf02a3a09c96f0957380416c40c4b925634b57da12bacadee830ada83afbdf0a0152ec9609f5101c0c98e67243fbc879d0bf4dd61c5cf6dd9cf181a4a23627865fdd0999fcb118700ae615634dd16b48325ba792fa7")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080dcbcbeeca88cdec1d4e915f69eabcfcf52704aff88793738b9e4bcfbc276b89caf76ef2081ca73b3a3cf5d08f1956f2e394fda4c927c67b7ee21391de84a5337580e66588ff45a54c551334203609171ce4f057eb5fe05ad8215fef57ce5ea512d5ce9b580b9baf29aa477b2fb39e361ca63d7825ef393894f4b6cc34b9272a1")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280009422394dcf84e669203d3b4d33ca5d8e82c4574c86ae6c455aabe90adda032db3bc7b2a567941cd8a60209a85886294f43b66ca26aa0d8e209e226e91dba6d9604ca2fad982b9f650f48af22db3c2d7ad68fd0c6b23cc1b44deb38063dba31f42fa5fa8f6e8a10fbb97bf5e124b393b27b448523231d8ef2488adf61c228fdb1b27c7b851c34809286ec0da345fa78cb4e96113005")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800094a29f1b32e762dc8323b56c278eeb8dbb3edb6b07f8f7dc361e5f273d710cd622f5e7b190551b4448b29e9dd075927e5862d5a84ebf153538237d76865148ad1ddc213fc43e4667135181aad4e8fdb21e9861b71cad5468dd60c26b22e0543921a1f7ce9eb0ac9bd7081523b546f3c0fb16f888dcc98abe253d34823455a94d1f1fb26058915c4eac42c9762b6777e5637a6eda7e")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080d3279b606d39322fd8f143a94954b1b321ac7e1e7d3398f6df0381a6059d8d57690b3dff75c9f52a88231ffa1d9a2273370d4f6ca8d1b49bc567f9c78fa0973e8da516a9b05ab955cf224ecf2673c5f7b732df190f22d0cb1a906ec3759b2ccffb22c13c02b50e8262c275fcfce0858884dd9d93fbb4490fbc19a030b51e0bc1")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080323b08c9a0baf05594db3a16a06ae089aba095536871793af184730e978f753ed19aed139d68daff1054e3d7fa3718ef3881bf0e518737264f2bd27805fea7b7a1a95ab8a8c23f39d22b250baa06e584d6aed565e46eb8d9f065682b7d8b60f024019cfa537c4155ed3ab3a951b691995434f29b772b371c390b372d0454170c")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008059d59a561f2de143c6060cbf203154961e2d5fa39956e67025d10c97eb592493f7603981a0630741000ea8605ef973eaff2c4f52792ffd9545b239e32bf8715292d0b53d792a1bf879baefa67176256e3eddf65a20c39ab6218518f00778f75c120b5002e371355ecf5348d8827456607414e8acb47905e6ad7c0057043779eb")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080953f2c1716218cb249dea65d101e64348f49b06fea6e962156efc34070d2d508f01ef72626b2bdc53b6522d1ec771faeba66f15d7f1c05e0867aa90f2eef65944101ffd95d5529a40068bb180a1e1275af591e686edea8f35f5576ac26e494812631b923c1c0f358a54ceb1ff0a59950a863ac3c00de19a4c97396ca11f67ade")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080f96f0664d4d9fd10039ed44f3f44d91b64b26d44ff7eb3160c75a2827718c981616029279338de90ce90aab05632f239e1754aa798d5abeb3976fad27df4c82444eb256aa798eb18c13e52f036fdc95fa0e1dd12db50a8e287ce6a40dd9163b4a2bddcca67e1f1c2cc21f32ced1a3bee20602e098d6cd2147ec8319a3d29aa79")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e04280008012f16cb6adfef08f2571c5e663a289350f468653386fc6c95cca29a10d70721db2f484d084bebd84612ebbaf49ea0b9495bcd212b2d6011d38bfd21da390359903770eafe6de7d4c636123321dd72cb597753524b41d01899d1fe8d6f93fbb48e24fdacf20ede15ca055a44fad3fb33b85e8b9d45cd25d758d5733ec0250a3d1")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080cd9e5beb04537af18b56feb2fdeaaf7238da25e34afa4a7afefa66bef33ff148e902c93d0da098ccf9084c80ea601516e13506d4ef5f47d234907bc8b6cf02bf0cdf101a4240a16111ff6e403232ae77502b0a7b2b1dd4ba42a8e177628a35ec47ef2d0b84017b16e2c70a04a84c8dfa2073d52f7847140809b433e8df37fd7c")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e042800080f44fa1960b93b3f4d5ecacf6da56c58bbce3ad9034ea57c96b8855a429e98c172db2ba476ffbcbedbaba51378f797c2223d8521597b16fff1380d0fc33f5276eb2a63e81efc3b86004bb7755bf3df47bd87dc04ecaebd8db90a15f21a743978b4cc080197a5b1b7084b2375a9a64db29471cdea4d37f0deb42b29721e085b958")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000a0fc8641642bc1316ac75720e00ec34b4b115d398c24f748f4d5c03b02b1a99b20522706c9e9e4de774762b88179d208d5155513b19b48990f151fc087d61ae382cd6fbc035cea383b732070c987535e2031f89f5b6f72b270e8f9e38fad6be4e1eefbd57693825e677680a76367a929f7784195164c48df4d1d713f6bd41b3eb4002a4e96299714652835b2fa272b6aec02ac889d4ce6d1137e34017e945da0ab")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000a0ae46f9c17c65e708e9df10bb18f87efdec837e5fff474cb8cc44e9ca1f3187bdb5a0a02b16c059167498c83f80aac81b899c8c4895de412a79567e99375d8902d4ff431e3221ae5cf6f49ff2390b0e134c7361683b8b5fc6ac560a426a7e35a063380a991b927f436d025b14bd97c82b939ee100fca25d496af3867086438ed0f7984b72d8a089d787de41c52e9b2e59786a33b494f1f66c9e179c3e5efb5173")
    assert sw == 0x9000
    sw, _ = transport.exchange_raw("e0428000290360e31600000000000c27ef9af87128c5167c6c74f93c06d85b65248bb9fbfd2aa6d9d72b5add6c10")
    assert sw == 0x9000
    sw, sig = transport.exchange_raw("e042800009000000000421ae2d00")

    sig = sig.hex()
    assert len(sig) == TXID_LEN
    assert sig[8:8+32*2+8] == EXPECTED_TRUSTED_INPUT
